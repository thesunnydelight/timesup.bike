---
import eventsData from '../content/events.json';

const sourceEvents = Array.isArray(eventsData?.events) ? eventsData.events : [];
const formattedEvents = sourceEvents.map((event) => {
	const descriptionLines = event.description.trim().split('\n').map((line) => line.trim());
	const lastLine = descriptionLines[descriptionLines.length - 1] ?? '';
	const hasTerminalPunctuation = /[.!?]$/.test(lastLine);

	return {
		...event,
		descriptionLines,
		hasTerminalPunctuation,
	};
});
---

<section id="events" class="page-section">
	<div class="wrapper">
		<h2>Upcoming Events</h2>
		<p class="lead">
			All events, bike rides, workshops, and pop-up exhibits are free and open to all; feel free to
			bring friends and share widely! Join our community across the city and help spread the word.
		</p>
		<div class="event-grid">
			{formattedEvents.map((event) => (
				<article class="event-card">
					<header class="event-header">
						<h3>{event.title}</h3>
						<p class="event-date">
							<span class="event-day">{event.day}</span>
							<span class="event-time">{event.time}</span>
						</p>
					</header>
					<p class="event-meta">{event.location}</p>
					<p class="event-description">
						{event.descriptionLines.map((line, index) => (
							<>
								{line}
								{index < event.descriptionLines.length - 1 && <br />}
							</>
						))}
						{event.link && (
							<>
								{event.hasTerminalPunctuation ? '' : '.'}{' '}
								<a href={event.link.url} target="_blank" rel="noreferrer">{event.link.label}</a>.
							</>
						)}
					</p>
				</article>
			))}
		</div>
	</div>
</section>

<style>
	#events {
		padding: 96px 16px;
		background: var(--site-gradient);
		display: flex;
		justify-content: center;
	}

	.wrapper {
		max-width: 960px;
		width: 100%;
		font-family: Helvetica, arial, sans-serif;
	}

	h2 {
		margin: 0 0 16px;
		font-size: 36px;
		color: #111827;
		text-align: center;
	}

	.lead {
		margin: 0 auto 32px;
		max-width: 760px;
		text-align: center;
		color: #4b5563;
		font-size: 18px;
		line-height: 1.6;
	}

	.event-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(min(360px, 100%), 1fr));
		gap: 24px;
	}

	.event-card {
		background: white;
		border-radius: 16px;
		padding: 24px;
		box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
		border: 1px solid rgba(15, 23, 42, 0.08);
		display: flex;
		flex-direction: column;
		gap: 12px;
		color: #1f2937;
	}

	.event-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-start;
		gap: 16px;
	}

	.event-header h3 {
		margin: 0;
		font-size: 22px;
		color: #0f172a;
	}

	.event-date {
		margin: 0;
		display: flex;
		flex-direction: column;
		align-items: flex-end;
		font-size: 15px;
		color: #2563eb;
		font-weight: 600;
	}

	.event-meta {
		margin: 0;
		font-size: 15px;
		color: #6b7280;
	}

	.event-description {
		margin: 0;
		font-size: 16px;
		line-height: 1.6;
		color: #374151;
	}

	.event-description a {
		color: #2563eb;
		text-decoration: none;
	}

	.event-description a:hover,
	.event-description a:focus {
		text-decoration: underline;
	}

	@media screen and (max-width: 768px) {
		#events {
			padding: 64px 16px;
		}

		.event-card {
			padding: 20px;
		}

		.event-header {
			flex-direction: column;
			align-items: flex-start;
		}

		.event-date {
			align-items: flex-start;
		}
	}
</style>
