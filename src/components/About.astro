---
import about from '../content/about.json';

const { title, paragraphs, instagramUrl } = about;
const supportUrl = 'https://times-up.org/support/';

const renderParagraph = (text) => {
	const replacements = [
		{
			keyword: 'Instagram',
			href: instagramUrl,
			attrs: { rel: 'noreferrer noopener', target: '_blank' },
		},
		{
			keyword: 'Support Page',
			href: supportUrl,
			attrs: { rel: 'noreferrer noopener', target: '_blank' },
		},
	].filter((item) => item.href && text.includes(item.keyword));

	if (replacements.length === 0) {
		return text;
	}

	const segments = [];
	let cursor = 0;

	while (cursor < text.length) {
		const nextMatch = replacements
			.map((item) => ({
				...item,
				index: text.indexOf(item.keyword, cursor),
			}))
			.filter((item) => item.index !== -1)
			.sort((a, b) => a.index - b.index)[0];

		if (!nextMatch) {
			segments.push(text.slice(cursor));
			break;
		}

		if (nextMatch.index > cursor) {
			segments.push(text.slice(cursor, nextMatch.index));
		}

		segments.push({
			type: 'link',
			value: nextMatch.keyword,
			href: nextMatch.href,
			attrs: nextMatch.attrs,
		});

		cursor = nextMatch.index + nextMatch.keyword.length;
	}

	return segments;
};
---

<section id="about" class="page-section">
	<div class="content box">
		<h2>{title}</h2>
		{paragraphs.map((text) => {
			const content = renderParagraph(text);

				return Array.isArray(content) ? (
					<p>
						{content.map((segment) =>
							segment?.type === 'link' ? (
								<a href={segment.href} rel={segment.attrs?.rel} target={segment.attrs?.target}>
									{segment.value}
								</a>
							) : (
								segment
							)
						)}
					</p>
				) : (
					<p>{content}</p>
				);
		})}
	</div>
</section>

<style>
	#about {
		display: flex;
		justify-content: center;
		padding: 96px 16px;
		background: var(--site-gradient);
	}

	.content {
		max-width: 720px;
		text-align: center;
		font-family: Helvetica, arial, sans-serif;
	}

	.box {
		padding: 32px;
		background: white;
		border-radius: 16px;
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
		display: flex;
		flex-direction: column;
		gap: 16px;
	}

	h2 {
		margin: 0;
		font-size: 32px;
		color: #111827;
	}

	p {
		margin: 0;
		color: #4b5563;
		font-size: 18px;
		line-height: 1.6;
	}

	@media screen and (max-width: 768px) {
		#about {
			padding: 64px 16px;
		}

		.box {
			padding: 24px;
		}
	}
</style>
